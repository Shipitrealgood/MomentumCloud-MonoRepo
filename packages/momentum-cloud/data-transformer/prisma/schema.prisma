generator client {
  provider = "prisma-client-js"
  output   = "generated/client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATA_TRANSFORMER_DATABASE_URL")
}

// ===================================
// Data Transformation Models
// ===================================

model DataTemplate {
  id          String   @id @default(cuid())
  templateKey String   @unique
  name        String
  type        TemplateType
  description String?
  
  fields      DataTemplateField[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

enum TemplateType {
  IMPORT
  EXPORT
}

model DataTemplateField {
  id               String  @id @default(cuid())
  templateId       String
  template         DataTemplate @relation(fields: [templateId], references: [id], onDelete: Cascade)

  sourceField      String
  destinationField String
  description      String?
  formatter        String?  // <-- This is the new, required field

  // This allows one source field to map to multiple destination fields (e.g., for splitting dates)
  @@unique([templateId, sourceField, destinationField])
}